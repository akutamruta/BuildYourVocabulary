<link rel="import" href="../bower_components/polymer/polymer.html" />

<polymer-element name="idb-store" attributes="name database data" >

	<script type="text/javascript">
		Polymer('idb-store', {

			name : "",
			database : null,
			data : null,

			createStore : function (db) {

				if(db != null && this.name != "") {

					if(!db.objectStoreNames.contains(this.name)) {
						db.createObjectStore(this.name);
					}
					this.fire('store-created');
				}
			},

			getData : function (key, mode) {
				if(this.database != null) {

					if(this.database.objectStoreNames.contains(this.name)) {
						var transaction = this.database.transaction([this.name],mode);
						var store = transaction.objectStore(this.name);

						console.log("reading from store", store);
						
						var ob = store.get(key);

						var context = this;
				
						ob.onsuccess = function (e) {
							context.data = e.target.result;
					        //console.log("Reading JSON from store : ",result);
					       
					        
					        //context.data = result;
					        context.fire('dataread-success');
						};

						ob.onerror = function (e) {
							console.log('couldnt get json from store');
							context.fire('dataread-error');
						}
					}
					else {
						/*if(mode == "readwrite") {
							this.createStore();
							this.getData();
						}
						else {
							this.fire('dataread-error');
						}*/
					}
				}
			},

			storeData : function (key, mode, data) {

				if(this.database.objectStoreNames.contains(this.name)) {
					var transaction = this.database.transaction([this.name],mode);
					var store = transaction.objectStore("wordlist");
					var request =  {};

					var ob = store.get(key);

					var context = this;
			
					ob.onsuccess = function (e) {
						result = e.target.result;
				        //console.log("Reading JSON from store : ",result);
				        
				        if(result == undefined  || result == null && context.data != null && context.data != undefined) {
				        	// TODO: Check if wordlist is there in the db
							var request = store.add(context.data, key);

							request.onerror = function(e) {
						        console.log("Error",e.target.error.name);
						        //some type of error handler
						    }
						 
						    request.onsuccess = function(e) {
						        console.log("Woot! Did it");
						    }
				        }
					};

					ob.onerror = function (e) {
						console.log('couldnt get json from store');
						context.fire('dataread-error');
					}
				}
				else {
					if(mode == "readwrite") {
						this.createStore();
						this.getData();
					}
					else {
						this.fire('dataread-error');
					}
				}
			}

			// console.log: it is assumed that data has not changed.. if data is there then we need
			// to do an update
		});

	</script>

</polymer-element>
